# NOTE: This docker-compose.yml file is for reference only.
# The session manager now creates containers individually with proper network isolation.
#
# Architecture:
# - Shared (single instance):
#   - itzg-server: Minecraft server on 'backend' network
# - Per-session (one per user):
#   - dashboard-<sid>: On both 'sess-<sid>' and 'backend' networks
#   - void-proxy-<sid>: On both 'sess-<sid>' (as "proxy") and 'backend' networks
#   - client-<sid>: Only on 'sess-<sid>' network
#
# Network flow:
# - client → void-proxy (via "proxy" alias on sess network)
# - void-proxy → itzg-server (via backend network)
# - client cannot reach itzg-server directly (network isolation)

services:
  # Dashboard: per-session, routes to session containers + shared itzg
  dashboard:
    build: dashboard
    ports:
      - "8080:8080"
    environment:
      VOID_CONTAINER_NAME: void-proxy-<sid>
      CLIENT_CONTAINER_NAME: client-<sid>
    restart: unless-stopped
    
  # Client: per-session, connects to void proxy only
  client:
    build: client
    restart: unless-stopped
    environment:
      SERVER: proxy  # Alias for void-proxy in session network

  # Void proxy: per-session, bridges client and itzg server
  void:
    build: terminal-void
    restart: unless-stopped
    environment:
      ARGUMENTS: --offline --ignore-file-servers --server itzg-server

  # itzg: SHARED across all sessions
  itzg:
    build: terminal-itzg
    restart: unless-stopped
    environment:
      EULA: "true"
      TYPE: "PAPER"
      VERSION: "LATEST"
      ONLINE_MODE: "false"
      OVERRIDE_SERVER_PROPERTIES: "true"
      SERVER_PORT: "25565"
